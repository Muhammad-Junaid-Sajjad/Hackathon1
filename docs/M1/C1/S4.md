---
id: m1-c1-s4
title: ROS 2 Installation and Workspace Configuration
sidebar_position: 4
keywords: ['ros2', 'installation', 'workspace', 'colcon', 'middleware', 'dds', 'kilted-kaiju', '2025']
last_updated: 2025-12-29
---

# ROS 2 Installation and Workspace Configuration

## Prerequisites

Before starting this section, you should have:
- Completed M1-C1-S1 (Workstation Setup with Ubuntu 24.04)
- Ubuntu 24.04 LTS installed and updated
- At least 50GB free disk space
- Internet connection for package downloads
- Basic familiarity with Linux terminal commands

## Learning Objectives

By the end of this section, you will be able to:
- **Define** what ROS 2 is and why it's called the robot's "nervous system"
- **Explain** the role of DDS middleware in robot communication
- **Install** ROS 2 Kilted Kaiju Desktop on Ubuntu 24.04
- **Configure** a colcon workspace for custom package development
- **Verify** your installation using ROS 2 CLI tools

## Key Concepts

| Term | Definition |
|------|------------|
| **ROS 2** | Robot Operating System 2 - middleware framework for robot software development providing communication, tools, and libraries |
| **Kilted Kaiju** | The latest ROS 2 release (May 2025), succeeding Humble LTS |
| **DDS** | Data Distribution Service - the underlying publish/subscribe middleware that ROS 2 uses for communication |
| **Colcon** | The build tool for ROS 2 that compiles packages and manages dependencies |
| **Workspace** | A directory containing ROS 2 source packages, build artifacts, and installed files |
| **Domain ID** | A number (0-101) that isolates ROS 2 communication between different robot systems |

---

## Introduction: The Robot's Nervous System

Think about how your body works. When you see a coffee cup, your eyes send signals to your brain, your brain decides to grab it, and motor signals travel to your arm muscles. All of this happens through your **nervous system**—a communication network connecting sensors, brain, and muscles.

A humanoid robot needs the same thing. Cameras generate images, but those images need to reach the object detector. The detector's output needs to reach the motion planner. The planner's commands need to reach the motors. Without a communication system, each component is isolated and useless.

**ROS 2 (Robot Operating System 2)** is that nervous system. Despite the name, it's not actually an operating system—it's **middleware** that provides:
- **Communication**: Publish/subscribe topics, request/response services
- **Tools**: Visualization (RViz2), debugging (rqt), simulation (Gazebo)
- **Libraries**: Transforms (TF2), navigation (Nav2), manipulation (MoveIt2)

:::tip Why This Matters
ROS 2 is the industry standard for robotics. Tesla's Optimus, Boston Dynamics' Spot, Amazon's warehouse robots, and NASA's Mars rovers all use ROS or ROS 2. Learning ROS 2 isn't just for this course—it's a career skill used at every major robotics company.
:::

---

## What Is ROS 2?

### Definition

**ROS 2** is a flexible framework for writing robot software. It provides a standardized way for different parts of a robot (sensors, planners, controllers) to communicate with each other, regardless of what programming language they're written in or what computer they run on.

### Why Do We Need ROS 2?

**Without ROS 2:**
- Each sensor driver is a standalone program with custom communication
- No standard way to visualize robot state
- Every team invents their own message formats
- Code sharing between projects is nearly impossible
- Multi-computer systems require custom networking code

**With ROS 2:**
- Standard message types (Image, PointCloud, JointState, Twist)
- Built-in visualization with RViz2
- Thousands of community packages available
- Easy integration of components from different sources
- Automatic discovery and communication across networks

### How Does ROS 2 Work?

ROS 2 uses a **publish/subscribe** model built on DDS (Data Distribution Service):

```
┌─────────────────────────────────────────────────────────────┐
│                   ROS 2 COMMUNICATION                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────────┐                    ┌──────────────┐       │
│  │   Camera     │                    │   Object     │       │
│  │   Node       │                    │   Detector   │       │
│  │              │     /camera/rgb    │              │       │
│  │   Publisher ─┼───────────────────▶│  Subscriber  │       │
│  │              │                    │              │       │
│  └──────────────┘                    └──────┬───────┘       │
│                                             │               │
│                                             │ /detections   │
│                                             ▼               │
│                                      ┌──────────────┐       │
│                                      │   Motion     │       │
│                                      │   Planner    │       │
│                                      │              │       │
│                                      │  Subscriber  │       │
│                                      └──────────────┘       │
│                                                             │
│  DDS Middleware (handles discovery, serialization, QoS)     │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### ROS 2 vs ROS 1

| Feature | ROS 1 | ROS 2 |
|---------|-------|-------|
| **Middleware** | Custom (rosmaster) | DDS (no single point of failure) |
| **Real-time** | Not supported | Supported with proper configuration |
| **Multi-robot** | Difficult | Built-in Domain ID isolation |
| **Security** | None | DDS-Security (encryption, authentication) |
| **Platforms** | Linux only | Linux, Windows, macOS, RTOS |
| **Support** | EOL 2027 | Humble LTS until then, Kilted Kaiju (2025) |

:::warning Important
ROS 1 is end-of-life. All new robotics projects should use ROS 2. This course uses ROS 2 (Kilted Kaiju 2025 on Ubuntu 24.04, or Humble LTS on Ubuntu 22.04).
:::

---

## Installation

### Step 1: Set Locale

```bash
# Ensure UTF-8 locale is configured
sudo apt update && sudo apt install locales -y
sudo locale-gen en_US en_US.UTF-8
sudo update-locale LC_ALL=en_US.UTF-8 LANG=en_US.UTF-8
export LANG=en_US.UTF-8

# Verify locale
locale
# Should show: LANG=en_US.UTF-8
```

### Step 2: Add ROS 2 Repository

```bash
# Install required tools
sudo apt install software-properties-common -y
sudo add-apt-repository universe -y
sudo apt update && sudo apt install curl -y

# Add ROS 2 GPG key
sudo curl -sSL https://raw.githubusercontent.com/ros/rosdistro/master/ros.key \
  -o /usr/share/keyrings/ros-archive-keyring.gpg

# Add ROS 2 repository to sources
echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/ros-archive-keyring.gpg] \
http://packages.ros.org/ros2/ubuntu $(. /etc/os-release && echo $UBUNTU_CODENAME) main" | \
sudo tee /etc/apt/sources.list.d/ros2.list > /dev/null

# Update package index
sudo apt update
```

### Step 3: Install ROS 2 Kilted Kaiju Desktop

```bash
# Install ROS 2 Kilted Kaiju Desktop (includes RViz2, rqt, demos)
sudo apt install ros-kilted-desktop -y

# Install development tools
sudo apt install ros-dev-tools -y
sudo apt install python3-colcon-common-extensions -y
sudo apt install python3-rosdep python3-vcstool -y

# Initialize rosdep (dependency manager)
sudo rosdep init
rosdep update
```

**Expected Duration**: 10-20 minutes depending on internet speed.

### Step 4: Configure Shell Environment

```bash
# Add ROS 2 setup to .bashrc (runs on every new terminal)
echo "" >> ~/.bashrc
echo "# ROS 2 Kilted Kaiju" >> ~/.bashrc
echo "source /opt/ros/kilted/setup.bash" >> ~/.bashrc

# Apply changes to current terminal
source ~/.bashrc

# Verify installation
ros2 --version
# Expected output: ros2 cli version 0.25.x
```

### Step 5: Verify Installation

```bash
# Run ROS 2 doctor to check installation
ros2 doctor

# List available commands
ros2 --help

# Check that core packages are installed
ros2 pkg list | head -20
```

**Expected Output** from `ros2 doctor`:
```
All 5 checks passed
```

---

## Workspace Configuration

### What Is a ROS 2 Workspace?

A **workspace** is a directory where you develop custom ROS 2 packages. It has a specific structure:

```
┌─────────────────────────────────────────────────────────────┐
│                  ROS 2 WORKSPACE STRUCTURE                   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ~/ros2_ws/                                                 │
│  │                                                          │
│  ├── src/                    ◀── YOUR CODE GOES HERE        │
│  │   ├── package_1/                                         │
│  │   ├── package_2/                                         │
│  │   └── package_3/                                         │
│  │                                                          │
│  ├── build/                  ◀── Compiled artifacts         │
│  │   └── (auto-generated)        (don't edit)               │
│  │                                                          │
│  ├── install/                ◀── Installed packages         │
│  │   └── (auto-generated)        (source setup.bash)        │
│  │                                                          │
│  └── log/                    ◀── Build logs                 │
│      └── (auto-generated)        (for debugging)            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### Create Your Workspace

```bash
# Create workspace directory
mkdir -p ~/ros2_ws/src
cd ~/ros2_ws

# Build empty workspace (initializes install/ directory)
colcon build --symlink-install

# Add workspace to shell configuration
echo "source ~/ros2_ws/install/setup.bash" >> ~/.bashrc
source ~/.bashrc

# Verify workspace
echo "Workspace: $PWD"
echo "ROS_DISTRO: $ROS_DISTRO"
```

**Expected Output**:
```
Workspace: /home/your-username/ros2_ws
ROS_DISTRO: humble
```

### Configure Environment Variables

Add these to your `~/.bashrc` for optimal ROS 2 configuration:

```bash
# ROS 2 Kilted Kaiju Environment
source /opt/ros/kilted/setup.bash
source ~/ros2_ws/install/setup.bash

# Domain ID - isolate your robot from others on network
export ROS_DOMAIN_ID=42  # Use unique value 0-101

# DDS Implementation (CycloneDDS is recommended)
export RMW_IMPLEMENTATION=rmw_cyclonedds_cpp

# Enable colorized console output
export RCUTILS_COLORIZED_OUTPUT=1

# Increase discovery timeout for large networks
export ROS_AUTOMATIC_DISCOVERY_RANGE=SUBNET
```

Apply changes:
```bash
source ~/.bashrc
echo "Domain ID: $ROS_DOMAIN_ID"
echo "DDS: $RMW_IMPLEMENTATION"
```

---

## Essential ROS 2 Packages

Install these packages for humanoid robotics development:

```bash
# Simulation (Gazebo)
sudo apt install ros-kilted-ros-gz -y

# Visualization
sudo apt install ros-kilted-rviz2 ros-kilted-rviz-visual-tools -y

# Navigation (Nav2)
sudo apt install ros-kilted-navigation2 ros-kilted-nav2-bringup -y

# Manipulation (MoveIt2)
sudo apt install ros-kilted-moveit -y

# Robot Control
sudo apt install ros-kilted-ros2-control ros-kilted-ros2-controllers -y
sudo apt install ros-kilted-joint-trajectory-controller -y

# Sensor Drivers
sudo apt install ros-kilted-realsense2-camera -y

# Localization
sudo apt install ros-kilted-robot-localization -y

# Diagnostic Tools
sudo apt install ros-kilted-rqt-* -y
```

---

## Colcon Build System

### Essential Colcon Commands

```bash
# Navigate to workspace
cd ~/ros2_ws

# Build all packages
colcon build

# Build with symlink install (faster for Python packages)
colcon build --symlink-install

# Build specific package only
colcon build --packages-select my_package

# Build with all CPU cores
colcon build --parallel-workers $(nproc)

# Clean rebuild
rm -rf build/ install/ log/
colcon build

# Build with verbose output (for debugging)
colcon build --event-handlers console_direct+
```

### Build Workflow

```
┌─────────────────────────────────────────────────────────────┐
│                   COLCON BUILD WORKFLOW                      │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. Edit source code in ~/ros2_ws/src/                      │
│                    │                                        │
│                    ▼                                        │
│  2. cd ~/ros2_ws && colcon build --symlink-install          │
│                    │                                        │
│                    ▼                                        │
│  3. source install/setup.bash                               │
│                    │                                        │
│                    ▼                                        │
│  4. ros2 run my_package my_node                             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## Domain ID Isolation

### Why Domain IDs Matter

Multiple ROS 2 systems on the same network can interfere with each other. Domain ID creates isolation:

```
┌─────────────────────────────────────────────────────────────┐
│                   DOMAIN ID ISOLATION                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Network: 192.168.1.0/24                                    │
│                                                             │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ Workstation │  │   Jetson    │  │  Unitree    │         │
│  │ Domain: 0   │  │  Domain: 42 │  │  Domain: 50 │         │
│  │             │  │             │  │             │         │
│  │ Can see ALL │  │ Isolated    │  │ Isolated    │         │
│  │  traffic    │  │ from others │  │ from others │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│                                                             │
│  Domain 0: Development/debugging (sees everything)          │
│  Domain 42: Your robot (isolated)                           │
│  Domain 50: Another robot (isolated)                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### Setting Domain ID

```bash
# Temporary (current terminal only)
export ROS_DOMAIN_ID=42
ros2 topic list  # Only sees topics from domain 42

# Permanent (add to ~/.bashrc)
echo "export ROS_DOMAIN_ID=42" >> ~/.bashrc
source ~/.bashrc
```

---

## Connection to Capstone

ROS 2 is the backbone of the entire capstone pipeline:

| Capstone Component | ROS 2 Role |
|-------------------|------------|
| **Voice Command** | Whisper node publishes `/voice_command` topic |
| **Planning** | LLM node subscribes to commands, publishes `/task_plan` |
| **Navigation** | Nav2 receives goals, publishes `/cmd_vel` |
| **Vision** | RealSense publishes `/camera/depth`, detector publishes `/detections` |
| **Manipulation** | IK service handles `/compute_ik` requests |

```
┌─────────────────────────────────────────────────────────────┐
│                    CAPSTONE PIPELINE                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Voice ──▶ Plan ──▶ Navigate ──▶ Vision ──▶ Manipulate     │
│    │        │          │           │           │            │
│    │        │          │           │           │            │
│    └────────┴──────────┴───────────┴───────────┘            │
│                        │                                    │
│              ┌─────────┴─────────┐                          │
│              │      ROS 2        │                          │
│              │                   │                          │
│              │  ALL communication│                          │
│              │  flows through    │                          │
│              │  ROS 2 topics     │                          │
│              │  and services     │                          │
│              └───────────────────┘                          │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## Summary

In this section, you learned:
- **ROS 2** is middleware that provides communication between robot components
- **Kilted Kaiju** (May 2025) is the latest ROS 2 release with Gazebo Ionic integration
- For Ubuntu 24.04, use Kilted Kaiju; for Ubuntu 22.04, Humble LTS remains supported until 2027
- **Colcon** is the build tool that compiles ROS 2 packages
- **Domain ID** isolates ROS 2 systems on the same network
- Your workspace at `~/ros2_ws` will hold all custom packages

**Key Commands to Remember:**
```bash
# Source ROS 2 environment
source /opt/ros/kilted/setup.bash
source ~/ros2_ws/install/setup.bash

# Build workspace
cd ~/ros2_ws && colcon build --symlink-install

# Check installation
ros2 doctor
ros2 --version

# List topics/nodes
ros2 topic list
ros2 node list
```

---

## Practice Exercises

### Exercise 1: Basic - Verify Installation
**Objective:** Confirm ROS 2 is installed correctly
**Time:** ~10 minutes

1. Run `ros2 doctor` and verify all checks pass
2. Run `ros2 pkg list | wc -l` to count installed packages
3. Launch RViz2 with `rviz2` and verify the GUI opens

**Expected Result:** Doctor passes, 200+ packages installed, RViz2 opens

<details>
<summary>Hint</summary>
If ros2 doctor fails, check that you've sourced the setup files:
`source /opt/ros/kilted/setup.bash`
</details>

---

### Exercise 2: Intermediate - Topic Communication
**Objective:** Test publish/subscribe communication
**Time:** ~20 minutes

1. Open two terminals
2. In Terminal 1: `ros2 topic pub /test std_msgs/msg/String "data: 'Hello ROS 2'"`
3. In Terminal 2: `ros2 topic echo /test`
4. Verify the message appears in Terminal 2
5. Use `ros2 topic info /test` to see publisher/subscriber count

**Success Criteria:**
- [ ] Message published successfully
- [ ] Message received in second terminal
- [ ] Topic info shows 1 publisher, 1 subscriber

---

### Exercise 3: Challenge - Custom Workspace Package
**Objective:** Create your first ROS 2 package
**Time:** ~30+ minutes

1. Navigate to `~/ros2_ws/src`
2. Create a package: `ros2 pkg create --build-type ament_python my_first_pkg`
3. Build the workspace
4. Verify the package is listed: `ros2 pkg list | grep my_first`

**Bonus:** Add a simple Python node that prints "Hello from my_first_pkg!"

---

## Troubleshooting

| Problem | Cause | Solution |
|---------|-------|----------|
| `ros2: command not found` | Setup not sourced | Run `source /opt/ros/kilted/setup.bash` |
| `colcon build` fails | Missing dependencies | Run `rosdep install --from-paths src -y` |
| Can't see topics from other machine | Different Domain ID | Set same `ROS_DOMAIN_ID` on both machines |
| RViz2 won't launch | Display not set | Check `echo $DISPLAY` is set (usually `:0`) |
| Package not found after build | Workspace not sourced | Run `source ~/ros2_ws/install/setup.bash` |

---

## What's Next?

In the next section, **M1-C1-S5: ROS 2 Nodes and Topics**, you will learn:
- How to create publisher and subscriber nodes in Python
- Understanding the publish/subscribe communication pattern
- Message types and custom message definitions
- Using `ros2 topic` commands for debugging

This will enable you to build the communication infrastructure for your humanoid robot!

---

## Further Reading

- [ROS 2 Kilted Kaiju Documentation](https://docs.ros.org/en/humble/)
- [ROS 2 Tutorials](https://docs.ros.org/en/humble/Tutorials.html)
- [Colcon Documentation](https://colcon.readthedocs.io/)
- [DDS Specification](https://www.omg.org/spec/DDS/)

:::info Industry Insight
NASA's Perseverance Mars rover uses a ROS-based framework for autonomous navigation. The flight software team reported that ROS's modular architecture allowed them to test navigation algorithms in simulation millions of times before deployment—catching bugs that would have been catastrophic on Mars where there's no "restart" button.
:::
