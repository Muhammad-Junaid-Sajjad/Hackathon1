---
id: m1-c1-s7
title: ROS 2 Command-Line Tools and Introspection
sidebar_position: 7
keywords: ['ros2-cli', 'rosbag', 'topic', 'node', 'service', 'introspection', 'debugging']
---

# ROS 2 Command-Line Tools and Introspection

## Prerequisites

Before starting this section, you should have:
- Completed M1-C1-S6 (TF2 and Coordinate Frames)
- ROS 2 Humble installed and sourced
- At least one ROS 2 node running (from previous sections)
- Terminal familiarity (tab completion, pipes, grep)
- Understanding of ROS 2 nodes, topics, and message types

## Learning Objectives

By the end of this section, you will be able to:
- **List** all running nodes, topics, services, and actions using CLI commands
- **Inspect** message contents with `ros2 topic echo` and measure rates with `ros2 topic hz`
- **Diagnose** system health issues using `ros2 doctor`
- **Record** sensor data to rosbag files for offline analysis
- **Replay** recorded data for deterministic testing of perception algorithms

## Key Concepts

| Term | Definition |
|------|------------|
| **CLI** | Command-Line Interface - text-based tools for interacting with ROS 2 |
| **Introspection** | Examining a running system to understand its state and behavior |
| **rosbag** | ROS 2's data recording format for capturing and replaying topic messages |
| **QoS** | Quality of Service - settings that control message delivery guarantees |
| **ROS_DOMAIN_ID** | Environment variable that isolates ROS 2 communication (0-101) |
| **rqt_graph** | Visual tool showing node-topic connections as a graph |

---

## Introduction: The Robot Debugger's Toolkit

Imagine you're a doctor diagnosing a patient. You wouldn't just guess—you'd use tools: stethoscope, blood pressure monitor, thermometer. Each tool gives you specific information about the patient's health.

When debugging a robot, you face the same challenge. The robot isn't working, but why? Is the camera publishing images? Is the navigation node receiving commands? Are messages arriving too slowly?

ROS 2's **command-line tools** are your diagnostic instruments. With a few keystrokes, you can:
- See every message flowing through the system
- Measure exactly how fast topics are publishing
- Record hours of sensor data for later analysis
- Replay that data to reproduce bugs deterministically

:::tip Why This Matters
Professional robotics engineers spend significant time debugging. At companies like Boston Dynamics and Tesla, the ability to quickly diagnose issues using CLI tools separates efficient developers from those who waste hours. Master these tools and you'll solve in minutes what others take hours to figure out.
:::

---

## What Are ROS 2 CLI Tools?

### Definition

**ROS 2 CLI tools** are command-line programs that let you inspect, debug, and control a running ROS 2 system without writing code. They follow a consistent grammar: `ros2 <verb> <noun> [options]`.

Think of them as a Swiss Army knife for robotics—compact tools that solve specific problems quickly.

### Why Do We Need CLI Tools?

**Without CLI Tools:**
- Must write code to inspect every topic
- Can't see what's happening in real-time
- Debugging requires recompiling nodes
- Capturing test data requires custom loggers
- System health issues are invisible

**With CLI Tools:**
- Instantly see all active nodes and topics
- Echo any message in real-time
- Debug without touching code
- Record/replay data with one command
- Automatic system health diagnostics

### CLI Command Structure

```
┌─────────────────────────────────────────────────────────────┐
│                    ROS 2 CLI STRUCTURE                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ros2 <verb> <noun> [options]                               │
│    │     │      │       │                                   │
│    │     │      │       └── Flags, arguments                │
│    │     │      │           (--rate, --once, etc.)          │
│    │     │      │                                           │
│    │     │      └── Resource name                           │
│    │     │          (/camera/rgb, /cmd_vel)                 │
│    │     │                                                  │
│    │     └── Resource type                                  │
│    │         (topic, node, service, action)                 │
│    │                                                        │
│    └── Action to perform                                    │
│        (list, echo, info, call, record)                     │
│                                                             │
│  Examples:                                                  │
│  ros2 topic list                                            │
│  ros2 topic echo /imu/data                                  │
│  ros2 node info /camera_node                                │
│  ros2 service call /add_ints example_interfaces/...        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## Topic Commands

Topics are the most common debugging target. These commands help you understand what data is flowing through your system.

### List Topics

```bash
ros2 topic list
```
**Output:**
```
/camera/depth/image_raw
/imu/data
/joint_commands
/parameter_events
/rosout
/tf
/tf_static
```

**With message types:**
```bash
ros2 topic list -t
```
**Output:**
```
/camera/depth/image_raw [sensor_msgs/msg/Image]
/imu/data [sensor_msgs/msg/Imu]
/joint_commands [sensor_msgs/msg/JointState]
```

### Echo Topic Messages

See live data flowing through a topic:

```bash
ros2 topic echo /imu/data
```
**Output:**
```yaml
header:
  stamp:
    sec: 1234567890
    nanosec: 123456789
  frame_id: imu_link
orientation:
  x: 0.0
  y: 0.0
  z: 0.0
  w: 1.0
angular_velocity:
  x: 0.001
  y: -0.002
  z: 0.0
```

**Echo only once:**
```bash
ros2 topic echo /imu/data --once
```

### Measure Topic Frequency

Critical for verifying sensors publish at expected rates:

```bash
ros2 topic hz /camera/depth/image_raw
```
**Output:**
```
average rate: 30.123
  min: 0.031s max: 0.035s std dev: 0.00098s window: 100
```

### Measure Topic Bandwidth

Check how much data a topic generates:

```bash
ros2 topic bw /camera/depth/image_raw
```
**Output:**
```
Subscribed to [/camera/depth/image_raw]
average: 14.32MB/s
  mean: 489.21KB min: 485.10KB max: 493.45KB window: 30
```

### Publish to Topic

Inject test messages without writing code:

```bash
# Publish once
ros2 topic pub --once /cmd_vel geometry_msgs/msg/Twist \
  "{linear: {x: 0.5, y: 0.0, z: 0.0}, angular: {x: 0.0, y: 0.0, z: 0.2}}"

# Publish at 10 Hz
ros2 topic pub --rate 10 /cmd_vel geometry_msgs/msg/Twist \
  "{linear: {x: 0.5}, angular: {z: 0.2}}"
```

:::warning Common Mistake
Publishing test commands to a real robot can cause unexpected motion. Always verify you're connected to simulation, not hardware, before using `ros2 topic pub` on control topics.
:::

---

## Node Commands

Understand which nodes are running and what they're connected to.

### List Nodes

```bash
ros2 node list
```
**Output:**
```
/camera_node
/imu_publisher
/joint_cmd_publisher
/sensor_listener
```

### Node Info

See a node's complete interface:

```bash
ros2 node info /camera_node
```
**Output:**
```
/camera_node
  Subscribers:
    /parameter_events: rcl_interfaces/msg/ParameterEvent
  Publishers:
    /camera/color/image_raw: sensor_msgs/msg/Image
    /camera/depth/image_raw: sensor_msgs/msg/Image
    /rosout: rcl_interfaces/msg/Log
  Service Servers:
    /camera_node/describe_parameters: rcl_interfaces/srv/DescribeParameters
    /camera_node/get_parameters: rcl_interfaces/srv/GetParameters
```

---

## Service Commands

Test request/response communication without writing client code.

### List Services

```bash
ros2 service list
```

### Call Service

```bash
ros2 service call /add_two_ints example_interfaces/srv/AddTwoInts "{a: 5, b: 3}"
```
**Output:**
```
requester: making request: example_interfaces.srv.AddTwoInts_Request(a=5, b=3)
response:
example_interfaces.srv.AddTwoInts_Response(sum=8)
```

---

## Parameter Commands

Adjust node settings at runtime without restarting.

```bash
# List parameters
ros2 param list /camera_node

# Get value
ros2 param get /camera_node depth_module.exposure

# Set value
ros2 param set /camera_node depth_module.exposure 10000

# Save all parameters
ros2 param dump /camera_node
```

---

## System Diagnosis

### ROS 2 Doctor

Comprehensive system health check:

```bash
ros2 doctor
```
**Output:**
```
NETWORK CONFIGURATION
- ROS_DOMAIN_ID: 42
- ROS_LOCALHOST_ONLY: 0
- RMW_IMPLEMENTATION: rmw_cyclonedds_cpp

PLATFORM INFORMATION
- system: Linux 6.5.0-35-generic
- hostname: workstation

NODE INFORMATION
- 4 nodes found

TOPIC INFORMATION
- 12 topics found

All 5 checks passed
```

### Visual Node Graph

```bash
rqt_graph
```

Opens a GUI showing how nodes connect through topics:

```
┌─────────────────────────────────────────────────────────────┐
│                      rqt_graph VIEW                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌────────────┐   /camera/rgb   ┌────────────┐            │
│   │  camera    │────────────────▶│  detector  │            │
│   │   node     │                 │   node     │            │
│   └────────────┘                 └─────┬──────┘            │
│                                        │                    │
│                              /detections                    │
│                                        │                    │
│                                        ▼                    │
│   ┌────────────┐   /cmd_vel    ┌────────────┐              │
│   │ navigation │◀──────────────│  planner   │              │
│   │   node     │               │   node     │              │
│   └────────────┘               └────────────┘              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## Rosbag: Recording and Replay

Rosbag is one of the most powerful tools for robotics development—capture real sensor data once, use it for testing forever.

### Recording Data

```bash
# Record specific topics
ros2 bag record /camera/depth/image_raw /imu/data

# Record all topics (caution: high disk usage)
ros2 bag record -a

# Record with compression
ros2 bag record --compression-mode file --compression-format zstd \
  /camera/depth/image_raw /imu/data

# Record with duration limit
ros2 bag record --duration 60 /camera/depth/image_raw /imu/data
```

### Playing Back Data

```bash
# Play at normal speed
ros2 bag play rosbag2_2024_01_15-10_30_45

# Play at 2x speed
ros2 bag play --rate 2.0 rosbag2_2024_01_15-10_30_45

# Play in loop
ros2 bag play --loop rosbag2_2024_01_15-10_30_45

# Play specific topics only
ros2 bag play --topics /camera/depth/image_raw rosbag2_2024_01_15-10_30_45
```

### Bag Information

```bash
ros2 bag info rosbag2_2024_01_15-10_30_45
```
**Output:**
```
Files:             rosbag2_2024_01_15-10_30_45_0.db3
Bag size:          1.2 GB
Duration:          60.123s
Start:             Jan 15 2024 10:30:45.123
End:               Jan 15 2024 10:31:45.246
Messages:          1805
Topic information:
  Topic: /camera/depth/image_raw | Type: sensor_msgs/msg/Image | Count: 1800
  Topic: /imu/data | Type: sensor_msgs/msg/Imu | Count: 12000
```

---

## CLI Cheat Sheet

### Topic Operations

| Command | Purpose |
|---------|---------|
| `ros2 topic list` | List all topics |
| `ros2 topic list -t` | List with message types |
| `ros2 topic echo <topic>` | Print live messages |
| `ros2 topic hz <topic>` | Measure frequency |
| `ros2 topic bw <topic>` | Measure bandwidth |
| `ros2 topic info <topic>` | Show publisher/subscriber count |
| `ros2 topic pub <topic> <type> <data>` | Publish message |

### Node Operations

| Command | Purpose |
|---------|---------|
| `ros2 node list` | List all nodes |
| `ros2 node info <node>` | Show node details |
| `ros2 run <pkg> <exec>` | Launch a node |

### Service Operations

| Command | Purpose |
|---------|---------|
| `ros2 service list` | List all services |
| `ros2 service type <srv>` | Show service type |
| `ros2 service call <srv> <type> <args>` | Call service |

### Bag Operations

| Command | Purpose |
|---------|---------|
| `ros2 bag record <topics>` | Record topics |
| `ros2 bag play <bag>` | Replay bag |
| `ros2 bag info <bag>` | Show bag metadata |

### Diagnosis

| Command | Purpose |
|---------|---------|
| `ros2 doctor` | System health check |
| `rqt_graph` | Visualize node graph |
| `rqt_console` | View log messages |

---

## Connection to Capstone

CLI tools are essential for every phase of capstone development:

| Capstone Component | CLI Usage |
|-------------------|-----------|
| **Voice Command** | Debug Whisper output with `ros2 topic echo /voice_command` |
| **Planning** | Test LLM service with `ros2 service call /plan_task` |
| **Navigation** | Verify `/cmd_vel` rate with `ros2 topic hz` |
| **Vision** | Record RGB-D dataset with `ros2 bag record` |
| **Manipulation** | Echo `/joint_commands` to verify IK output |

```
┌─────────────────────────────────────────────────────────────┐
│                    CAPSTONE PIPELINE                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Voice ──▶ Plan ──▶ Navigate ──▶ Vision ──▶ Manipulate     │
│    │        │          │           │           │            │
│  echo     call        hz         bag        echo           │
│  /voice   /plan      /cmd       record     /joint          │
│  _cmd     _task      _vel       /camera    _commands       │
│                                                             │
│         ┌─────────────────────────────────────┐             │
│         │          CLI TOOLS                  │             │
│         │                                     │             │
│         │  [THIS SECTION]: Debug, record,     │             │
│         │  replay, and diagnose everything    │             │
│         └─────────────────────────────────────┘             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## Summary

In this section, you learned:
- **CLI tools** let you inspect and debug without writing code
- **`ros2 topic`** commands show what data is flowing
- **`ros2 doctor`** diagnoses system configuration issues
- **rosbag** records and replays sensor data deterministically
- **rqt_graph** visualizes node connections

**Key Commands to Remember:**
```bash
# See what's running
ros2 node list
ros2 topic list

# Inspect data
ros2 topic echo /topic_name
ros2 topic hz /topic_name

# Diagnose problems
ros2 doctor
rqt_graph

# Record/replay
ros2 bag record /topic1 /topic2
ros2 bag play rosbag_folder
```

---

## Practice Exercises

### Exercise 1: Basic - System Exploration
**Objective:** Use CLI tools to explore a running system
**Time:** ~10 minutes

1. Start turtlesim: `ros2 run turtlesim turtlesim_node`
2. In another terminal: `ros2 run turtlesim turtle_teleop_key`
3. Use `ros2 node list` to see both nodes
4. Use `ros2 topic list` to see all topics
5. Echo `/turtle1/cmd_vel` while pressing arrow keys
6. Measure the frequency of `/turtle1/pose`

**Expected Result:** You see velocity commands and ~62 Hz pose updates

<details>
<summary>Hint</summary>
The teleop node only publishes when you press keys. Hold an arrow key to see continuous messages with `ros2 topic echo /turtle1/cmd_vel`.
</details>

---

### Exercise 2: Intermediate - Data Recording
**Objective:** Record and replay turtle movement
**Time:** ~20 minutes

1. Start turtlesim nodes (as above)
2. Record turtle pose: `ros2 bag record /turtle1/pose`
3. Move the turtle around for 30 seconds
4. Stop recording (Ctrl+C)
5. Reset turtle position (close and reopen turtlesim)
6. Replay the bag and observe the pose updates

**Success Criteria:**
- [ ] Bag file created successfully
- [ ] `ros2 bag info` shows ~1800 messages (62 Hz × 30s)
- [ ] Replay publishes pose data (verify with echo)

---

### Exercise 3: Challenge - Remote Debugging
**Objective:** Debug a simulated multi-machine setup
**Time:** ~30+ minutes

Simulate remote debugging by:
1. Open two terminals with different ROS_DOMAIN_IDs
2. Run publisher in one, subscriber in other
3. Use `ros2 doctor` to diagnose why they can't communicate
4. Fix the issue and verify with `ros2 topic echo`

**Bonus:** Use `ros2 multicast receive` to test network multicast connectivity.

---

## Troubleshooting

| Problem | Cause | Solution |
|---------|-------|----------|
| `ros2: command not found` | ROS 2 not sourced | Run `source /opt/ros/humble/setup.bash` |
| Topic list empty | No nodes running | Start a node first |
| Can't see remote nodes | Domain ID mismatch | Set same `ROS_DOMAIN_ID` |
| Bag playback too fast | Default rate | Use `ros2 bag play --rate 0.5` |
| High bag file size | Recording raw images | Use `--compression-mode file` |

---

## What's Next?

With Chapter 1 complete, you now have a solid ROS 2 foundation! In **M1-C2: ROS 2 Services and Actions**, you will learn:
- Synchronous request/response with Services
- Long-running tasks with feedback using Actions
- Quality of Service (QoS) settings
- Custom message and service definitions

This will enable you to build more sophisticated robot behaviors!

---

## Further Reading

- [ROS 2 CLI Tools Tutorial](https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools.html)
- [rosbag2 Documentation](https://github.com/ros2/rosbag2)
- [rqt User Guide](https://docs.ros.org/en/humble/Concepts/About-RQt.html)
- [ROS 2 Doctor](https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Getting-Started-With-Ros2doctor.html)

:::info Industry Insight
At Waymo (Google's autonomous vehicle division), engineers use ROS-like bag files to replay billions of miles of driving data. When they improve their perception algorithms, they can test against all previously recorded scenarios without putting a single car on the road. This "data-driven development" approach—enabled by recording and replay tools—is standard practice at every autonomous vehicle company.
:::
