---
id: m1-c2-s3
title: ROS 2 Parameters and Dynamic Reconfiguration
sidebar_position: 3
keywords: ['parameters', 'config', 'dynamic-reconfigure', 'runtime-config']
---

# ROS 2 Parameters and Dynamic Reconfiguration

## Prerequisites

| Requirement | Description |
|-------------|-------------|
| **M1-C1-S4** | ROS 2 Kilted Kaiju installed and sourced |
| **M1-C1-S5** | Understanding of ROS 2 nodes |
| **M1-C2-S1** | Familiarity with Python ROS 2 nodes |
| **Python** | Basic Python classes and callbacks |

## Learning Objectives

By the end of this section, you will be able to:

1. **Declare parameters** with type constraints and descriptions
2. **Validate parameter changes** using callback-based reconfiguration
3. **Load/save parameters** from YAML configuration files
4. **Monitor parameter events** for reactive programming patterns
5. **Apply parameters** via CLI, launch files, and programmatically

## Key Concepts

| Concept | Description | CLI Command |
|---------|-------------|-------------|
| **Parameter Declaration** | Register typed parameters at node startup | `ros2 param list` |
| **Parameter Descriptor** | Metadata: type, constraints, read-only flag | `ros2 param describe` |
| **Parameter Callback** | Validation/reaction function on changes | (programmatic) |
| **Parameter Events** | Global topic for parameter change notifications | `ros2 topic echo /parameter_events` |
| **YAML Config** | File-based parameter storage and loading | `ros2 param dump/load` |

```
┌─────────────────────────────────────────────────────────────────┐
│                    Parameter Architecture                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────────┐         ┌─────────────────────────────┐  │
│   │   YAML Config   │         │         ros2 param          │  │
│   │  (params.yaml)  │         │   set/get/list/describe     │  │
│   └────────┬────────┘         └─────────────┬───────────────┘  │
│            │                                 │                   │
│            ▼                                 ▼                   │
│   ┌────────────────────────────────────────────────────────┐   │
│   │                    ROS 2 Node                           │   │
│   │  ┌──────────────────────────────────────────────────┐  │   │
│   │  │              Parameter Server                     │  │   │
│   │  │  ┌─────────────┐  ┌─────────────┐  ┌──────────┐  │  │   │
│   │  │  │  exposure   │  │    gain     │  │frame_rate│  │  │   │
│   │  │  │   (int)     │  │   (int)     │  │ (double) │  │  │   │
│   │  │  └─────────────┘  └─────────────┘  └──────────┘  │  │   │
│   │  └──────────────────────────┬───────────────────────┘  │   │
│   │                             │                           │   │
│   │                    ┌────────▼────────┐                  │   │
│   │                    │ Param Callback  │                  │   │
│   │                    │  (validation)   │                  │   │
│   │                    └────────┬────────┘                  │   │
│   └─────────────────────────────┼──────────────────────────┘   │
│                                 │                               │
│                                 ▼                               │
│                    ┌────────────────────────┐                  │
│                    │  /parameter_events     │                  │
│                    │  (global notification) │                  │
│                    └────────────────────────┘                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## Overview

ROS 2 **parameters** enable runtime configuration without recompiling or restarting nodes. Parameters store configuration values (camera exposure, PID gains, navigation speeds) that can be read, written, and persisted to YAML files. Unlike ROS 1's dynamic_reconfigure, ROS 2 parameters are first-class citizens with built-in CLI tools and parameter events for reactive behavior.

**What You'll Build**: A camera controller node with dynamically adjustable exposure, gain, and frame rate parameters, demonstrating parameter declaration, validation, and callback-based reconfiguration.

## Hardware Requirements

**Workstation** (from M1-C1-S1)
- ROS 2 Kilted Kaiju installed (M1-C1-S4)
- Python 3.10+

## Connection to Capstone

The capstone relies on parameters for all tunable configuration:

1. **Perception**: Camera exposure, object detection confidence threshold, VSLAM keyframe frequency
2. **Navigation**: Max velocity, obstacle inflation radius, local planner lookahead distance
3. **Manipulation**: PID gains for joint controllers, gripper force limits, trajectory smoothing
4. **Voice**: Whisper language model selection, VAD sensitivity, wake word threshold

Parameters allow **field tuning** without code changes—adjust navigation speed for crowded vs. open environments, or camera exposure for indoor vs. outdoor lighting.

## Implementation

### Parameters vs. Launch Arguments

| Aspect | Parameters | Launch Arguments |
|--------|-----------|------------------|
| **Scope** | Node runtime state | Launch-time configuration |
| **Mutability** | Changeable at runtime | Fixed at launch |
| **Persistence** | Save/load from YAML | Command-line only |
| **Use Case** | Camera settings, PID gains | Node names, topic remapping |
| **CLI Access** | `ros2 param set/get` | `ros2 launch --show-args` |

**Rule of Thumb**: Use **parameters** for values that may need runtime adjustment, **launch arguments** for static configuration.

### Step 1: Declare Parameters in Node

**File**: `~/ros2_ws/src/humanoid_control/scripts/camera_controller.py`

```python
#!/usr/bin/env python3
"""
Camera Controller with Dynamic Parameters
Demonstrates parameter declaration, validation, and callbacks
"""

import rclpy
from rclpy.node import Node
from rcl_interfaces.msg import ParameterDescriptor, ParameterType
from rclpy.parameter import Parameter

class CameraController(Node):
    def __init__(self):
        super().__init__('camera_controller')

        # Declare parameters with descriptors
        self.declare_parameter(
            'exposure',
            8500,  # Default value
            ParameterDescriptor(
                type=ParameterType.PARAMETER_INTEGER,
                description='Camera exposure time in microseconds',
                read_only=False,
                additional_constraints='Range: 100-20000'
            )
        )

        self.declare_parameter(
            'gain',
            16,
            ParameterDescriptor(
                type=ParameterType.PARAMETER_INTEGER,
                description='Camera analog gain (dB)',
                read_only=False,
                additional_constraints='Range: 0-48'
            )
        )

        self.declare_parameter(
            'frame_rate',
            30.0,
            ParameterDescriptor(
                type=ParameterType.PARAMETER_DOUBLE,
                description='Camera frame rate (FPS)',
                read_only=False,
                additional_constraints='Range: 5.0-60.0'
            )
        )

        self.declare_parameter(
            'auto_exposure',
            True,
            ParameterDescriptor(
                type=ParameterType.PARAMETER_BOOL,
                description='Enable auto-exposure',
                read_only=False
            )
        )

        self.declare_parameter(
            'camera_name',
            'realsense_d435i',
            ParameterDescriptor(
                type=ParameterType.PARAMETER_STRING,
                description='Camera identifier',
                read_only=True  # Cannot be changed at runtime
            )
        )

        # Register parameter change callback
        self.add_on_set_parameters_callback(self.parameter_callback)

        # Apply initial parameters
        self.apply_parameters()

        self.get_logger().info('Camera Controller initialized with parameters:')
        self.log_current_parameters()

    def parameter_callback(self, params):
        """
        Called when parameters are modified via CLI or API

        Args:
            params: List of Parameter objects to be set

        Returns:
            SetParametersResult indicating success/failure
        """
        from rcl_interfaces.msg import SetParametersResult

        for param in params:
            # Validate exposure range
            if param.name == 'exposure':
                if not (100 <= param.value <= 20000):
                    self.get_logger().error(f'Invalid exposure {param.value}: must be 100-20000')
                    return SetParametersResult(successful=False)

            # Validate gain range
            elif param.name == 'gain':
                if not (0 <= param.value <= 48):
                    self.get_logger().error(f'Invalid gain {param.value}: must be 0-48')
                    return SetParametersResult(successful=False)

            # Validate frame rate
            elif param.name == 'frame_rate':
                if not (5.0 <= param.value <= 60.0):
                    self.get_logger().error(f'Invalid frame_rate {param.value}: must be 5.0-60.0')
                    return SetParametersResult(successful=False)

            # Read-only parameter
            elif param.name == 'camera_name':
                self.get_logger().error('camera_name is read-only')
                return SetParametersResult(successful=False)

        # All validations passed, apply parameters
        self.apply_parameters()
        self.get_logger().info('Parameters updated:')
        self.log_current_parameters()

        return SetParametersResult(successful=True)

    def apply_parameters(self):
        """Apply current parameters to camera (simulated)"""
        exposure = self.get_parameter('exposure').value
        gain = self.get_parameter('gain').value
        frame_rate = self.get_parameter('frame_rate').value
        auto_exposure = self.get_parameter('auto_exposure').value
        camera_name = self.get_parameter('camera_name').value

        # In real implementation, send commands to camera driver:
        # self.camera.set_exposure(exposure)
        # self.camera.set_gain(gain)
        # self.camera.set_frame_rate(frame_rate)

        self.get_logger().info(f'Applied camera settings to {camera_name}')

    def log_current_parameters(self):
        """Log all current parameter values"""
        exposure = self.get_parameter('exposure').value
        gain = self.get_parameter('gain').value
        frame_rate = self.get_parameter('frame_rate').value
        auto_exposure = self.get_parameter('auto_exposure').value
        camera_name = self.get_parameter('camera_name').value

        self.get_logger().info(f'  exposure: {exposure} us')
        self.get_logger().info(f'  gain: {gain} dB')
        self.get_logger().info(f'  frame_rate: {frame_rate} FPS')
        self.get_logger().info(f'  auto_exposure: {auto_exposure}')
        self.get_logger().info(f'  camera_name: {camera_name}')


def main(args=None):
    rclpy.init(args=args)
    node = CameraController()

    try:
        rclpy.spin(node)
    except KeyboardInterrupt:
        pass
    finally:
        node.destroy_node()
        rclpy.shutdown()


if __name__ == '__main__':
    main()
```

**Make Executable**:
```bash
chmod +x ~/ros2_ws/src/humanoid_control/scripts/camera_controller.py
```

### Step 2: Test Parameter Operations

**Terminal 1** (Start Camera Controller):
```bash
source ~/ros2_ws/install/setup.bash
ros2 run humanoid_control camera_controller.py
```

**Expected Output**:
```
[INFO] [camera_controller]: Camera Controller initialized with parameters:
[INFO] [camera_controller]:   exposure: 8500 us
[INFO] [camera_controller]:   gain: 16 dB
[INFO] [camera_controller]:   frame_rate: 30.0 FPS
[INFO] [camera_controller]:   auto_exposure: True
[INFO] [camera_controller]:   camera_name: realsense_d435i
```

**Terminal 2** (List Parameters):
```bash
ros2 param list /camera_controller
```

**Output**:
```
/camera_controller:
  auto_exposure
  camera_name
  exposure
  frame_rate
  gain
  use_sim_time
```

**Get Parameter Value**:
```bash
ros2 param get /camera_controller exposure
```

**Output**:
```
Integer value is: 8500
```

**Set Parameter Value**:
```bash
ros2 param set /camera_controller exposure 12000
```

**Output**:
```
Set parameter successful
```

**Node Output** (shows callback triggered):
```
[INFO] [camera_controller]: Parameters updated:
[INFO] [camera_controller]:   exposure: 12000 us
[INFO] [camera_controller]:   gain: 16 dB
[INFO] [camera_controller]:   frame_rate: 30.0 FPS
[INFO] [camera_controller]:   auto_exposure: True
[INFO] [camera_controller]:   camera_name: realsense_d435i
```

**Invalid Parameter** (validation fails):
```bash
ros2 param set /camera_controller exposure 50000
```

**Output**:
```
Setting parameter failed: Invalid exposure 50000: must be 100-20000
```

### Step 3: Parameter YAML Files

**Create Parameter File**: `~/ros2_ws/camera_params.yaml`

```yaml
/camera_controller:
  ros__parameters:
    exposure: 10000
    gain: 20
    frame_rate: 30.0
    auto_exposure: false
    camera_name: "realsense_d435i"
```

**Launch Node with Parameters**:
```bash
ros2 run humanoid_control camera_controller.py --ros-args --params-file ~/ros2_ws/camera_params.yaml
```

**Expected Output**:
```
[INFO] [camera_controller]: Camera Controller initialized with parameters:
[INFO] [camera_controller]:   exposure: 10000 us
[INFO] [camera_controller]:   gain: 20 dB
[INFO] [camera_controller]:   frame_rate: 30.0 FPS
[INFO] [camera_controller]:   auto_exposure: False
[INFO] [camera_controller]:   camera_name: realsense_d435i
```

**Dump Current Parameters to YAML**:
```bash
ros2 param dump /camera_controller --output-dir ~/ros2_ws/
```

**Output**: Creates `camera_controller.yaml` with current values.

**Load Parameters at Runtime**:
```bash
ros2 param load /camera_controller ~/ros2_ws/camera_params.yaml
```

### Step 4: Parameter Events (Reactive Programming)

Subscribe to parameter changes from another node:

```python
#!/usr/bin/env python3
"""
Parameter Monitor - Reacts to parameter changes
"""

import rclpy
from rclpy.node import Node
from rcl_interfaces.msg import ParameterEvent

class ParameterMonitor(Node):
    def __init__(self):
        super().__init__('parameter_monitor')

        # Subscribe to global parameter events
        self.subscription = self.create_subscription(
            ParameterEvent,
            '/parameter_events',
            self.parameter_event_callback,
            10
        )

        self.get_logger().info('Parameter Monitor started')

    def parameter_event_callback(self, msg):
        """Handle parameter change events"""
        node_name = msg.node

        # Filter for camera_controller events
        if 'camera_controller' not in node_name:
            return

        # Process changed parameters
        for param in msg.changed_parameters:
            self.get_logger().info(f'{node_name}: {param.name} changed to {param.value}')

        # Process new parameters
        for param in msg.new_parameters:
            self.get_logger().info(f'{node_name}: New parameter {param.name} = {param.value}')

        # Process deleted parameters
        for param in msg.deleted_parameters:
            self.get_logger().info(f'{node_name}: Parameter {param.name} deleted')


def main(args=None):
    rclpy.init(args=args)
    node = ParameterMonitor()

    try:
        rclpy.spin(node)
    except KeyboardInterrupt:
        pass
    finally:
        node.destroy_node()
        rclpy.shutdown()


if __name__ == '__main__':
    main()
```

### Step 5: Launch with Parameters

**Launch File**: `~/ros2_ws/src/humanoid_control/launch/camera_with_params.launch.py`

```python
from launch import LaunchDescription
from launch_ros.actions import Node

def generate_launch_description():
    return LaunchDescription([
        Node(
            package='humanoid_control',
            executable='camera_controller.py',
            name='camera_controller',
            output='screen',
            parameters=[{
                'exposure': 12000,
                'gain': 24,
                'frame_rate': 30.0,
                'auto_exposure': False,
                'camera_name': 'realsense_d435i'
            }]
        )
    ])
```

**Launch**:
```bash
ros2 launch humanoid_control camera_with_params.launch.py
```

## Parameter Best Practices

### 1. Declare All Parameters at Startup

Undeclared parameters cannot be listed or validated:

```python
# Good: Declare with descriptor
self.declare_parameter('exposure', 8500, ParameterDescriptor(...))

# Bad: Implicit declaration (no validation)
exposure = self.get_parameter_or('exposure', 8500)  # Old ROS 1 pattern
```

### 2. Validate Parameter Ranges

Prevent invalid configurations:

```python
def parameter_callback(self, params):
    for param in params:
        if param.name == 'max_velocity':
            if param.value > 2.0:
                self.get_logger().error('max_velocity exceeds safe limit (2.0 m/s)')
                return SetParametersResult(successful=False)
    return SetParametersResult(successful=True)
```

### 3. Use Read-Only for Immutable Config

Prevent runtime changes to critical identifiers:

```python
self.declare_parameter(
    'robot_id',
    'unitree_g1_01',
    ParameterDescriptor(read_only=True)  # Cannot change after launch
)
```

### 4. Group Related Parameters

Use namespaces for organization:

```yaml
/camera_controller:
  ros__parameters:
    camera:
      exposure: 10000
      gain: 20
    processing:
      denoise: true
      sharpen: false
```

Access with dot notation:
```python
self.declare_parameter('camera.exposure', 10000)
exposure = self.get_parameter('camera.exposure').value
```

## Common Parameter Patterns

### Pattern 1: PID Controller

```python
self.declare_parameter('pid.kp', 1.0)
self.declare_parameter('pid.ki', 0.1)
self.declare_parameter('pid.kd', 0.05)
self.declare_parameter('pid.output_limit', 100.0)

# Apply changes immediately
def parameter_callback(self, params):
    self.kp = self.get_parameter('pid.kp').value
    self.ki = self.get_parameter('pid.ki').value
    self.kd = self.get_parameter('pid.kd').value
    self.update_pid_controller()
    return SetParametersResult(successful=True)
```

### Pattern 2: Feature Toggles

```python
self.declare_parameter('features.enable_obstacle_avoidance', True)
self.declare_parameter('features.enable_dynamic_replan', False)
self.declare_parameter('features.debug_visualization', False)

if self.get_parameter('features.enable_obstacle_avoidance').value:
    self.setup_obstacle_detection()
```

### Pattern 3: Environment-Specific Config

```yaml
# Indoor configuration
/nav2_controller:
  ros__parameters:
    max_velocity: 0.5
    obstacle_inflation: 0.3

# Outdoor configuration
/nav2_controller:
  ros__parameters:
    max_velocity: 1.5
    obstacle_inflation: 0.5
```

Load conditionally in launch file:
```python
import os
config_file = os.path.join(get_package_share_directory('humanoid_navigation'),
                          'config', 'indoor_params.yaml')
```

## Parameter CLI Cheat Sheet

| Command | Purpose | Example |
|---------|---------|---------|
| `ros2 param list` | List all parameters | `ros2 param list /camera_controller` |
| `ros2 param get` | Get parameter value | `ros2 param get /camera_controller exposure` |
| `ros2 param set` | Set parameter value | `ros2 param set /camera_controller exposure 12000` |
| `ros2 param describe` | Show parameter details | `ros2 param describe /camera_controller exposure` |
| `ros2 param dump` | Save parameters to YAML | `ros2 param dump /camera_controller` |
| `ros2 param load` | Load parameters from YAML | `ros2 param load /camera_controller params.yaml` |

**Describe Parameter** (shows constraints):
```bash
ros2 param describe /camera_controller exposure
```

**Output**:
```
Parameter name: exposure
  Type: integer
  Description: Camera exposure time in microseconds
  Constraints: Range: 100-20000
  Read only: False
```

## Parameter Types

ROS 2 supports the following parameter types:

| Type | Python Type | Example Value |
|------|-------------|---------------|
| `PARAMETER_BOOL` | `bool` | `True`, `False` |
| `PARAMETER_INTEGER` | `int` | `8500`, `-10` |
| `PARAMETER_DOUBLE` | `float` | `30.5`, `3.14159` |
| `PARAMETER_STRING` | `str` | `"realsense_d435i"` |
| `PARAMETER_BYTE_ARRAY` | `bytes` | `b'\x00\x01\x02'` |
| `PARAMETER_BOOL_ARRAY` | `list[bool]` | `[True, False, True]` |
| `PARAMETER_INTEGER_ARRAY` | `list[int]` | `[1, 2, 3, 4]` |
| `PARAMETER_DOUBLE_ARRAY` | `list[float]` | `[1.0, 2.5, 3.7]` |
| `PARAMETER_STRING_ARRAY` | `list[str]` | `["cam1", "cam2"]` |

## Next Steps

With parameters mastered, proceed to:
- **M1-C2-S4**: Custom Messages (define domain-specific message types)
- **M1-C2-S5**: Launch Files (orchestrate multi-node systems with parameters)
- **M1-C2-S6**: QoS Policies (configure reliability and durability)

**Troubleshooting**:
- **Parameter not found**: Check node is running: `ros2 node list`
- **Set parameter fails**: Check validation in `parameter_callback`
- **YAML load fails**: Verify YAML syntax and namespace structure
- **Read-only error**: Remove `read_only=True` or restart node with new value

**Real-World Parameter Examples**:
- Nav2: `max_velocity`, `obstacle_radius`, `controller_frequency`
- RealSense: `depth_module.exposure`, `rgb_camera.auto_exposure_priority`
- MoveIt2: `planning_time`, `max_velocity_scaling_factor`, `trajectory_execution.execution_duration_monitoring`

---

**Assessment Preparation**: This section is **ESSENTIAL** for **Assessment 1: ROS 2 Fundamentals Quiz (Week 3)**. You must demonstrate parameter declaration, validation, and dynamic reconfiguration.
