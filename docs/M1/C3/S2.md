---
id: m1-c3-s2
title: Xacro Macros for Modular Robot Models
sidebar_position: 2
keywords: ['xacro', 'macros', 'modular', 'urdf', 'parametric', 'code-reuse']
---

# Xacro Macros for Modular Robot Models

## Prerequisites

| Requirement | Description |
|-------------|-------------|
| **M1-C3-S1** | URDF basics (links, joints, geometry) |
| **XML** | XML syntax and namespaces |
| **Programming** | Basic programming concepts (variables, functions, conditionals) |

## Learning Objectives

By the end of this section, you will be able to:

1. **Use Xacro properties** to eliminate magic numbers
2. **Create reusable macros** for repetitive structures (arms, legs, wheels)
3. **Apply conditionals** for hardware variant selection
4. **Organize modular robot descriptions** across multiple files
5. **Generate URDF variants** from single Xacro source

## Key Concepts

| Concept | Syntax | Purpose |
|---------|--------|---------|
| **Property** | `<xacro:property name="L" value="0.3"/>` | Named constants |
| **Arithmetic** | `${L * 2 + 0.1}` | Computed values |
| **Macro** | `<xacro:macro name="arm" params="prefix">` | Reusable components |
| **Include** | `<xacro:include filename="..."/>` | Modular files |
| **Conditional** | `<xacro:if value="${use_sensor}">` | Optional features |
| **Argument** | `<xacro:arg name="use_sim" default="false"/>` | CLI parameters |

## Overview

**Xacro** (XML Macros) extends URDF with programming constructs—macros, properties, conditionals, and arithmetic—enabling parametric robot descriptions. Xacro eliminates URDF duplication: define an arm macro once, instantiate it twice for left/right arms with different parameters. This section converts the humanoid URDF to Xacro, creates reusable arm/leg macros, and demonstrates property-based configuration.

**What You'll Build**: A modular humanoid Xacro model with parameterized left/right arms, configurable link lengths, and conditional sensor inclusion (RealSense vs. ZED camera).

## Hardware Requirements

**Workstation** (from M1-C1-S1)
- ROS 2 Kilted Kaiju installed (M1-C1-S4)
- Xacro processor (included in ROS 2)

## Connection to Capstone

The capstone Xacro model:

1. **Left/Right Symmetry**: Single arm macro instantiated twice with `prefix="left"` and `prefix="right"`
2. **Hardware Variants**: Conditional sensor mounts (`use_realsense`, `use_zed`)
3. **Calibration**: Link length properties tuned per robot (`upper_arm_length: 0.305` for robot #1, `0.298` for robot #2)
4. **Gripper Variants**: Robotiq 2F-85 vs. custom 3-finger gripper via macro parameters
5. **Simulation vs. Real**: Inertial properties adjusted for Gazebo vs. real hardware

Without Xacro, maintaining URDFs for multiple robot variants requires duplicating 1000+ lines per robot.

## Implementation

### Xacro vs. URDF

| Feature | URDF | Xacro |
|---------|------|-------|
| **Macros** | No | Yes (`<xacro:macro>`) |
| **Properties** | No | Yes (`<xacro:property name="L" value="0.3"/>`) |
| **Arithmetic** | No | Yes (`${L * 2 + 0.1}`) |
| **Conditionals** | No | Yes (`<xacro:if value="${use_sensor}">`) |
| **File Inclusion** | No | Yes (`<xacro:include filename="..."/>`) |
| **Processing** | Direct parse | Requires `xacro` command |

**Xacro Processing**:
```bash
xacro humanoid.urdf.xacro > humanoid.urdf
# Expands macros → generates final URDF
```

### Step 1: Basic Xacro Syntax

**File**: `~/ros2_ws/src/humanoid_description/urdf/humanoid_arm.urdf.xacro`

```xml
<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="humanoid_arm">

  <!-- Properties (constants) -->
  <xacro:property name="M_PI" value="3.14159265359"/>
  <xacro:property name="torso_width" value="0.3"/>
  <xacro:property name="torso_depth" value="0.4"/>
  <xacro:property name="torso_height" value="0.6"/>
  <xacro:property name="upper_arm_length" value="0.30"/>
  <xacro:property name="forearm_length" value="0.25"/>

  <!-- Base Link (using properties) -->
  <link name="base_link">
    <visual>
      <geometry>
        <box size="${torso_width} ${torso_depth} ${torso_height}"/>
      </geometry>
      <material name="gray">
        <color rgba="0.5 0.5 0.5 1.0"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <box size="${torso_width} ${torso_depth} ${torso_height}"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="15.0"/>
      <inertia ixx="0.5" ixy="0.0" ixz="0.0"
               iyy="0.5" iyz="0.0"
               izz="0.3"/>
    </inertial>
  </link>

  <!-- Arithmetic in origin -->
  <joint name="shoulder_pan_joint" type="revolute">
    <parent link="base_link"/>
    <child link="shoulder_link"/>
    <!-- Position shoulder at half torso height -->
    <origin xyz="0.0 ${torso_depth/2 + 0.05} ${torso_height/2}" rpy="0 0 0"/>
    <axis xyz="0 0 1"/>
    <limit lower="${-M_PI}" upper="${M_PI}" effort="50.0" velocity="2.0"/>
    <dynamics damping="0.7"/>
  </joint>

  <!-- Remaining links/joints from S1... -->

</robot>
```

### Step 2: Arm Macro (Reusable Component)

**File**: `~/ros2_ws/src/humanoid_description/urdf/macros/arm_macro.urdf.xacro`

```xml
<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- Arm Macro: 7-DOF humanoid arm
       Parameters:
         - prefix: "left" or "right"
         - parent: Parent link name
         - xyz: Shoulder mounting position
         - rpy: Shoulder mounting orientation
  -->
  <xacro:macro name="humanoid_arm" params="prefix parent *origin">

    <!-- Shoulder Pan Link -->
    <link name="${prefix}_shoulder_pan_link">
      <visual>
        <geometry>
          <cylinder radius="0.05" length="0.1"/>
        </geometry>
        <material name="blue">
          <color rgba="0.0 0.0 1.0 1.0"/>
        </material>
      </visual>
      <collision>
        <geometry>
          <cylinder radius="0.05" length="0.1"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="1.0"/>
        <inertia ixx="0.01" ixy="0.0" ixz="0.0"
                 iyy="0.01" iyz="0.0"
                 izz="0.005"/>
      </inertial>
    </link>

    <!-- Shoulder Pan Joint -->
    <joint name="${prefix}_shoulder_pan_joint" type="revolute">
      <parent link="${parent}"/>
      <child link="${prefix}_shoulder_pan_link"/>
      <xacro:insert_block name="origin"/>
      <axis xyz="0 0 1"/>
      <limit lower="${-M_PI}" upper="${M_PI}" effort="50.0" velocity="2.0"/>
      <dynamics damping="0.7"/>
    </joint>

    <!-- Shoulder Lift Joint -->
    <joint name="${prefix}_shoulder_lift_joint" type="revolute">
      <parent link="${prefix}_shoulder_pan_link"/>
      <child link="${prefix}_upper_arm_link"/>
      <origin xyz="0.0 0.0 0.05" rpy="0 0 0"/>
      <axis xyz="0 1 0"/>
      <limit lower="${-M_PI/2}" upper="${M_PI/2}" effort="50.0" velocity="2.0"/>
      <dynamics damping="0.7"/>
    </joint>

    <!-- Upper Arm Link -->
    <link name="${prefix}_upper_arm_link">
      <visual>
        <geometry>
          <box size="0.08 0.08 ${upper_arm_length}"/>
        </geometry>
        <origin xyz="0 0 ${upper_arm_length/2}" rpy="0 0 0"/>
        <material name="blue"/>
      </visual>
      <collision>
        <geometry>
          <box size="0.08 0.08 ${upper_arm_length}"/>
        </geometry>
        <origin xyz="0 0 ${upper_arm_length/2}" rpy="0 0 0"/>
      </collision>
      <inertial>
        <mass value="2.0"/>
        <origin xyz="0 0 ${upper_arm_length/2}" rpy="0 0 0"/>
        <inertia ixx="0.02" ixy="0.0" ixz="0.0"
                 iyy="0.02" iyz="0.0"
                 izz="0.005"/>
      </inertial>
    </link>

    <!-- Elbow Joint -->
    <joint name="${prefix}_elbow_flex_joint" type="revolute">
      <parent link="${prefix}_upper_arm_link"/>
      <child link="${prefix}_forearm_link"/>
      <origin xyz="0.0 0.0 ${upper_arm_length}" rpy="0 0 0"/>
      <axis xyz="0 1 0"/>
      <limit lower="0.0" upper="${150.0 * M_PI / 180.0}" effort="30.0" velocity="2.0"/>
      <dynamics damping="0.5"/>
    </joint>

    <!-- Forearm Link -->
    <link name="${prefix}_forearm_link">
      <visual>
        <geometry>
          <box size="0.06 0.06 ${forearm_length}"/>
        </geometry>
        <origin xyz="0 0 ${forearm_length/2}" rpy="0 0 0"/>
        <material name="blue"/>
      </visual>
      <collision>
        <geometry>
          <box size="0.06 0.06 ${forearm_length}"/>
        </geometry>
        <origin xyz="0 0 ${forearm_length/2}" rpy="0 0 0"/>
      </collision>
      <inertial>
        <mass value="1.5"/>
        <origin xyz="0 0 ${forearm_length/2}" rpy="0 0 0"/>
        <inertia ixx="0.015" ixy="0.0" ixz="0.0"
                 iyy="0.015" iyz="0.0"
                 izz="0.003"/>
      </inertial>
    </link>

    <!-- Wrist Joint -->
    <joint name="${prefix}_wrist_flex_joint" type="revolute">
      <parent link="${prefix}_forearm_link"/>
      <child link="${prefix}_wrist_link"/>
      <origin xyz="0.0 0.0 ${forearm_length}" rpy="0 0 0"/>
      <axis xyz="0 1 0"/>
      <limit lower="${-M_PI/2}" upper="${M_PI/2}" effort="20.0" velocity="2.0"/>
      <dynamics damping="0.3"/>
    </joint>

    <!-- Wrist Link -->
    <link name="${prefix}_wrist_link">
      <visual>
        <geometry>
          <cylinder radius="0.03" length="0.08"/>
        </geometry>
        <material name="gray"/>
      </visual>
      <collision>
        <geometry>
          <cylinder radius="0.03" length="0.08"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="0.5"/>
        <inertia ixx="0.001" ixy="0.0" ixz="0.0"
                 iyy="0.001" iyz="0.0"
                 izz="0.0005"/>
      </inertial>
    </link>

    <!-- Gripper Joint -->
    <joint name="${prefix}_gripper_joint" type="fixed">
      <parent link="${prefix}_wrist_link"/>
      <child link="${prefix}_gripper_link"/>
      <origin xyz="0.0 0.0 0.08" rpy="0 0 0"/>
    </joint>

    <!-- Gripper Link -->
    <link name="${prefix}_gripper_link">
      <visual>
        <geometry>
          <box size="0.08 0.04 0.06"/>
        </geometry>
        <material name="red">
          <color rgba="1.0 0.0 0.0 1.0"/>
        </material>
      </visual>
      <collision>
        <geometry>
          <box size="0.08 0.04 0.06"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="0.3"/>
        <inertia ixx="0.0005" ixy="0.0" ixz="0.0"
                 iyy="0.0005" iyz="0.0"
                 izz="0.0003"/>
      </inertial>
    </link>

  </xacro:macro>

</robot>
```

### Step 3: Instantiate Macro for Both Arms

**File**: `~/ros2_ws/src/humanoid_description/urdf/humanoid_dual_arm.urdf.xacro`

```xml
<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="humanoid_dual_arm">

  <!-- Include arm macro -->
  <xacro:include filename="$(find humanoid_description)/urdf/macros/arm_macro.urdf.xacro"/>

  <!-- Properties -->
  <xacro:property name="M_PI" value="3.14159265359"/>
  <xacro:property name="torso_width" value="0.3"/>
  <xacro:property name="torso_depth" value="0.4"/>
  <xacro:property name="torso_height" value="0.6"/>
  <xacro:property name="upper_arm_length" value="0.30"/>
  <xacro:property name="forearm_length" value="0.25"/>
  <xacro:property name="shoulder_offset_y" value="0.20"/>  <!-- Shoulder spacing -->

  <!-- Base Link -->
  <link name="base_link">
    <visual>
      <geometry>
        <box size="${torso_width} ${torso_depth} ${torso_height}"/>
      </geometry>
      <material name="gray">
        <color rgba="0.5 0.5 0.5 1.0"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <box size="${torso_width} ${torso_depth} ${torso_height}"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="15.0"/>
      <inertia ixx="0.5" ixy="0.0" ixz="0.0"
               iyy="0.5" iyz="0.0"
               izz="0.3"/>
    </inertial>
  </link>

  <!-- Instantiate RIGHT arm -->
  <xacro:humanoid_arm prefix="right" parent="base_link">
    <origin xyz="0.0 ${-shoulder_offset_y} ${torso_height/2}" rpy="0 0 0"/>
  </xacro:humanoid_arm>

  <!-- Instantiate LEFT arm -->
  <xacro:humanoid_arm prefix="left" parent="base_link">
    <origin xyz="0.0 ${shoulder_offset_y} ${torso_height/2}" rpy="0 0 0"/>
  </xacro:humanoid_arm>

</robot>
```

**Process Xacro to URDF**:
```bash
cd ~/ros2_ws/src/humanoid_description/urdf
xacro humanoid_dual_arm.urdf.xacro > humanoid_dual_arm.urdf

# Verify
check_urdf humanoid_dual_arm.urdf
# Output: 11 links (base + 2 arms × 5 links)
```

### Step 4: Conditional Sensor Inclusion

**Sensor Macro**: `~/ros2_ws/src/humanoid_description/urdf/macros/sensors.urdf.xacro`

```xml
<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- RealSense D435i Macro -->
  <xacro:macro name="realsense_d435i" params="parent *origin">
    <joint name="camera_mount_joint" type="fixed">
      <parent link="${parent}"/>
      <child link="camera_link"/>
      <xacro:insert_block name="origin"/>
    </joint>

    <link name="camera_link">
      <visual>
        <geometry>
          <box size="0.09 0.025 0.025"/>  <!-- RealSense dimensions -->
        </geometry>
        <material name="camera_black">
          <color rgba="0.1 0.1 0.1 1.0"/>
        </material>
      </visual>
      <collision>
        <geometry>
          <box size="0.09 0.025 0.025"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="0.072"/>  <!-- 72g actual weight -->
        <inertia ixx="0.0001" ixy="0.0" ixz="0.0"
                 iyy="0.0001" iyz="0.0"
                 izz="0.00005"/>
      </inertial>
    </link>

    <!-- Camera optical frame (Z-forward convention) -->
    <joint name="camera_optical_joint" type="fixed">
      <parent link="camera_link"/>
      <child link="camera_depth_optical_frame"/>
      <origin xyz="0.0 0.0 0.0" rpy="${-M_PI/2} 0.0 ${-M_PI/2}"/>
    </joint>

    <link name="camera_depth_optical_frame"/>
  </xacro:macro>

  <!-- BNO055 IMU Macro -->
  <xacro:macro name="bno055_imu" params="parent *origin">
    <joint name="imu_joint" type="fixed">
      <parent link="${parent}"/>
      <child link="imu_link"/>
      <xacro:insert_block name="origin"/>
    </joint>

    <link name="imu_link">
      <visual>
        <geometry>
          <box size="0.03 0.03 0.01"/>  <!-- BNO055 dimensions -->
        </geometry>
        <material name="green">
          <color rgba="0.0 1.0 0.0 1.0"/>
        </material>
      </visual>
      <collision>
        <geometry>
          <box size="0.03 0.03 0.01"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="0.005"/>  <!-- 5g -->
        <inertia ixx="0.000001" ixy="0.0" ixz="0.0"
                 iyy="0.000001" iyz="0.0"
                 izz="0.0000005"/>
      </inertial>
    </link>
  </xacro:macro>

</robot>
```

**Main Xacro with Conditionals**:
```xml
<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="humanoid_full">

  <!-- Configuration flags -->
  <xacro:arg name="use_realsense" default="true"/>
  <xacro:arg name="use_imu" default="true"/>
  <xacro:arg name="use_dual_arms" default="true"/>

  <!-- Include macros -->
  <xacro:include filename="$(find humanoid_description)/urdf/macros/arm_macro.urdf.xacro"/>
  <xacro:include filename="$(find humanoid_description)/urdf/macros/sensors.urdf.xacro"/>

  <!-- Properties -->
  <xacro:property name="M_PI" value="3.14159265359"/>

  <!-- Base Link -->
  <link name="base_link">
    <!-- ... torso definition ... -->
  </link>

  <!-- Right arm (always included) -->
  <xacro:humanoid_arm prefix="right" parent="base_link">
    <origin xyz="0.0 -0.20 0.3" rpy="0 0 0"/>
  </xacro:humanoid_arm>

  <!-- Left arm (conditional) -->
  <xacro:if value="$(arg use_dual_arms)">
    <xacro:humanoid_arm prefix="left" parent="base_link">
      <origin xyz="0.0 0.20 0.3" rpy="0 0 0"/>
    </xacro:humanoid_arm>
  </xacro:if>

  <!-- RealSense camera (conditional) -->
  <xacro:if value="$(arg use_realsense)">
    <xacro:realsense_d435i parent="base_link">
      <origin xyz="0.15 0.0 0.5" rpy="0 0.2618 0"/>  <!-- 15° tilt down -->
    </xacro:realsense_d435i>
  </xacro:if>

  <!-- IMU (conditional) -->
  <xacro:if value="$(arg use_imu)">
    <xacro:bno055_imu parent="base_link">
      <origin xyz="0.0 0.0 0.25" rpy="0 0 0"/>
    </xacro:bno055_imu>
  </xacro:if>

</robot>
```

**Generate URDF Variants**:
```bash
# Full config: dual arms + sensors
xacro humanoid_full.urdf.xacro use_realsense:=true use_imu:=true use_dual_arms:=true > full.urdf

# Single arm + sensors (for testing)
xacro humanoid_full.urdf.xacro use_dual_arms:=false > single_arm.urdf

# Dual arms, no sensors (for kinematic-only sim)
xacro humanoid_full.urdf.xacro use_realsense:=false use_imu:=false > kinematic_only.urdf
```

### Step 5: Inertial Macro (DRY for Repeated Calculations)

```xml
<!-- Macro: Box inertial properties
     Calculates inertia tensor from dimensions
-->
<xacro:macro name="box_inertial" params="mass x y z">
  <inertial>
    <mass value="${mass}"/>
    <inertia ixx="${mass/12 * (y*y + z*z)}" ixy="0.0" ixz="0.0"
             iyy="${mass/12 * (x*x + z*z)}" iyz="0.0"
             izz="${mass/12 * (x*x + y*y)}"/>
  </inertial>
</xacro:macro>

<!-- Usage -->
<link name="upper_arm_link">
  <visual>...</visual>
  <collision>...</collision>
  <xacro:box_inertial mass="2.0" x="0.08" y="0.08" z="0.30"/>
</link>
```

**Cylinder Inertial Macro**:
```xml
<xacro:macro name="cylinder_inertial" params="mass radius length">
  <inertial>
    <mass value="${mass}"/>
    <inertia ixx="${mass/12 * (3*radius*radius + length*length)}" ixy="0.0" ixz="0.0"
             iyy="${mass/12 * (3*radius*radius + length*length)}" iyz="0.0"
             izz="${mass/2 * radius*radius}"/>
  </inertial>
</xacro:macro>
```

### Step 6: Launch with Xacro

**Update Launch File** to process Xacro:
```python
from launch import LaunchDescription
from launch_ros.actions import Node
from launch.substitutions import Command
import os
from ament_index_python.packages import get_package_share_directory

def generate_launch_description():
    xacro_file = os.path.join(
        get_package_share_directory('humanoid_description'),
        'urdf',
        'humanoid_full.urdf.xacro'
    )

    # Process xacro to URDF
    robot_description = Command([
        'xacro ', xacro_file,
        ' use_realsense:=true',
        ' use_imu:=true',
        ' use_dual_arms:=true'
    ])

    return LaunchDescription([
        Node(
            package='robot_state_publisher',
            executable='robot_state_publisher',
            name='robot_state_publisher',
            output='screen',
            parameters=[{
                'robot_description': robot_description
            }]
        ),

        Node(
            package='joint_state_publisher_gui',
            executable='joint_state_publisher_gui',
            name='joint_state_publisher_gui'
        ),

        Node(
            package='rviz2',
            executable='rviz2',
            name='rviz2',
            arguments=['-d', os.path.join(
                get_package_share_directory('humanoid_description'),
                'rviz', 'urdf_viewer.rviz'
            )]
        )
    ])
```

**Launch with Arguments**:
```bash
ros2 launch humanoid_description display_urdf.launch.py \
  use_realsense:=true use_dual_arms:=false
```

## Xacro Best Practices

### 1. Properties for Magic Numbers

```xml
<!-- Good: Named constants -->
<xacro:property name="wheel_radius" value="0.05"/>
<geometry>
  <cylinder radius="${wheel_radius}" length="0.03"/>
</geometry>

<!-- Bad: Magic numbers -->
<geometry>
  <cylinder radius="0.05" length="0.03"/>
</geometry>
```

### 2. Macros for Repetitive Structures

```xml
<!-- Good: Macro for 4 wheels -->
<xacro:macro name="wheel" params="prefix parent xyz">
  <!-- Single wheel definition -->
</xacro:macro>

<xacro:wheel prefix="front_left" parent="base_link" xyz="0.2 0.15 0"/>
<xacro:wheel prefix="front_right" parent="base_link" xyz="0.2 -0.15 0"/>
<xacro:wheel prefix="rear_left" parent="base_link" xyz="-0.2 0.15 0"/>
<xacro:wheel prefix="rear_right" parent="base_link" xyz="-0.2 -0.15 0"/>

<!-- Bad: Copy-paste 4 times (error-prone) -->
```

### 3. File Organization

```
urdf/
├── humanoid.urdf.xacro           # Main robot description
├── macros/
│   ├── arm_macro.urdf.xacro      # Arm definition
│   ├── leg_macro.urdf.xacro      # Leg definition
│   ├── sensors.urdf.xacro        # Sensor macros
│   └── inertials.urdf.xacro      # Inertial helpers
└── materials.urdf.xacro          # Material definitions
```

### 4. Argument Defaults

```xml
<!-- Good: Sensible defaults -->
<xacro:arg name="use_gpu_lidar" default="false"/>

<!-- Usage -->
<xacro:if value="$(arg use_gpu_lidar)">
  <!-- High-res lidar for sim -->
</xacro:if>
```

## Xacro Advanced Features

### Conditionals

```xml
<!-- If-else pattern -->
<xacro:if value="${use_heavy_payload}">
  <xacro:property name="gripper_force" value="100.0"/>
</xacro:if>
<xacro:unless value="${use_heavy_payload}">
  <xacro:property name="gripper_force" value="30.0"/>
</xacro:unless>
```

### Loops (via Python expressions)

```xml
<!-- Generate 5 finger joints -->
<xacro:macro name="hand" params="prefix">
  <xacro:property name="finger_count" value="5"/>

  <!-- Note: Xacro doesn't have native loops, use macro recursion or Python -->
  <!-- Alternative: Use separate macro calls -->
  <xacro:finger prefix="${prefix}_thumb" parent="${prefix}_palm" xyz="0.02 0 0"/>
  <xacro:finger prefix="${prefix}_index" parent="${prefix}_palm" xyz="0.04 0.02 0"/>
  <xacro:finger prefix="${prefix}_middle" parent="${prefix}_palm" xyz="0.04 0 0"/>
  <xacro:finger prefix="${prefix}_ring" parent="${prefix}_palm" xyz="0.04 -0.02 0"/>
  <xacro:finger prefix="${prefix}_pinky" parent="${prefix}_palm" xyz="0.02 -0.04 0"/>
</xacro:macro>
```

### Property Files (External Configuration)

**File**: `~/ros2_ws/src/humanoid_description/urdf/config/robot_params.yaml`

```yaml
# Robot-specific calibrated dimensions
upper_arm_length: 0.305  # Measured from robot #1
forearm_length: 0.248
gripper_max_width: 0.085
shoulder_offset_y: 0.198

# Actuator limits
max_shoulder_torque: 52.0  # N⋅m
max_elbow_torque: 28.0
max_wrist_torque: 18.0
```

**Load in Xacro** (requires custom script, not native Xacro feature):
```python
# In launch file
import yaml
with open(params_file, 'r') as f:
    params = yaml.safe_load(f)

robot_description = Command([
    'xacro ', xacro_file,
    f' upper_arm_length:={params["upper_arm_length"]}',
    f' forearm_length:={params["forearm_length"]}'
])
```

## Next Steps

With Xacro mastered, proceed to:
- **M1-C3-S3**: Forward Kinematics (compute end-effector pose from URDF + joint angles)
- **M1-C3-S4**: Inverse Kinematics (analytical and numerical solvers)
- **M1-C3-S5**: IMU Integration (sensor frame definition in URDF)

**Troubleshooting**:
- **Xacro parse error**: Check XML syntax, ensure `xmlns:xacro` namespace is declared
- **Macro not found**: Verify `<xacro:include>` path is correct
- **Property undefined**: Check property is declared before use
- **Conditional not working**: Use `$(arg name)` for launch args, `${property}` for xacro properties

**Real-World Xacro Examples**:
- UR5 robot: `ur_description/urdf/ur.urdf.xacro`
- TurtleBot3: `turtlebot3_description/urdf/turtlebot3_burger.urdf.xacro`
- Clearpath Husky: `husky_description/urdf/husky.urdf.xacro`

---

**Assessment Preparation**: This section is **CRITICAL** for **Assessment 2: URDF and Kinematics (Week 6)**. You must demonstrate creating Xacro macros, using properties, and generating URDF variants.
