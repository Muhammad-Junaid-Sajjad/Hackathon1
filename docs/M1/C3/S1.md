---
id: m1-c3-s1
title: URDF Basics and Humanoid Robot Description
sidebar_position: 1
keywords: ['urdf', 'robot-description', 'links', 'joints', 'rviz2', 'robot-state-publisher']
---

# URDF Basics and Humanoid Robot Description

## Prerequisites

| Requirement | Description |
|-------------|-------------|
| **M1-C1-S4** | ROS 2 Humble installed and workspace configured |
| **M1-C1-S6** | Understanding of TF2 and coordinate frames |
| **XML** | Basic XML syntax (tags, attributes, nesting) |
| **3D Geometry** | Basic understanding of rotation, translation, and coordinate systems |

## Learning Objectives

By the end of this section, you will be able to:

1. **Define robot structure** using URDF links and joints
2. **Specify geometry** for visual rendering and collision detection
3. **Configure joint types** (revolute, prismatic, fixed) with limits
4. **Visualize URDF** in RViz2 with robot_state_publisher
5. **Validate URDF** using check_urdf and graphviz tools

## Key Concepts

| Concept | Description | Example |
|---------|-------------|---------|
| **Link** | Rigid body (physical component) | `base_link`, `upper_arm_link` |
| **Joint** | Connection between links with motion constraints | `shoulder_pan_joint` (revolute) |
| **Visual** | Geometry for rendering (meshes, primitives) | STL mesh, box, cylinder |
| **Collision** | Simplified geometry for collision detection | Cylinder approximating arm |
| **Inertial** | Mass and inertia tensor for dynamics | Required for Gazebo |

## Overview

URDF (Unified Robot Description Format) is ROS 2's XML-based language for defining robot kinematics, geometry, and visual appearance. URDF files declare **links** (rigid bodies like base, arms, legs) and **joints** (connections with motion constraints) that enable forward kinematics, collision detection, and visualization in RViz2. This section creates a simplified humanoid URDF with 7-DOF arm, visualizes it in RViz2, and integrates with the robot_state_publisher for automatic TF broadcasting.

**What You'll Build**: A canonical URDF for a humanoid upper body (torso + 7-DOF arm + gripper) with visual/collision geometry, joint limits, and RViz2 visualization.

## Hardware Requirements

**Workstation** (from M1-C1-S1)
- ROS 2 Humble installed (M1-C1-S4)
- RViz2 for visualization
- Meshlab (optional, for viewing STL meshes)

## Connection to Capstone

The capstone URDF defines:

1. **Kinematics**: 7-DOF arms (shoulders, elbows, wrists) for IK/FK calculations
2. **Sensors**: RealSense D435i mount (camera_link), BNO055 IMU (imu_link)
3. **Collision Geometry**: Simplified cylinders/boxes for self-collision and obstacle avoidance
4. **Visualization**: STL meshes for realistic rendering in RViz2/Gazebo
5. **TF Tree**: robot_state_publisher auto-broadcasts transforms from URDF + joint_states

Without URDF, you cannot compute reachability (IK requires link lengths), plan collision-free paths, or visualize the robot.

## Implementation

### URDF Structure

```xml
<robot name="humanoid">
  <!-- Links: Rigid bodies -->
  <link name="base_link">...</link>
  <link name="shoulder_link">...</link>

  <!-- Joints: Connections between links -->
  <joint name="shoulder_pan_joint" type="revolute">
    <parent link="base_link"/>
    <child link="shoulder_link"/>
    <axis xyz="0 0 1"/>  <!-- Rotation axis -->
    <limit lower="-3.14" upper="3.14" effort="50" velocity="2.0"/>
  </joint>
</robot>
```

**Key Elements**:
- **Links**: Physical bodies (base, arm segments, gripper)
- **Joints**: Motion constraints (revolute, prismatic, fixed)
- **Geometry**: Visual (meshes) and collision (simplified shapes)
- **Inertial**: Mass, center of mass, inertia tensor (for dynamics)

### Step 1: Minimal Humanoid URDF

**File**: `~/ros2_ws/src/humanoid_description/urdf/humanoid_arm.urdf`

```xml
<?xml version="1.0"?>
<robot name="humanoid_arm">

  <!-- Base Link (Torso) -->
  <link name="base_link">
    <visual>
      <geometry>
        <box size="0.3 0.4 0.6"/>  <!-- 30cm × 40cm × 60cm torso -->
      </geometry>
      <material name="gray">
        <color rgba="0.5 0.5 0.5 1.0"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <box size="0.3 0.4 0.6"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="15.0"/>  <!-- 15 kg torso -->
      <inertia ixx="0.5" ixy="0.0" ixz="0.0"
               iyy="0.5" iyz="0.0"
               izz="0.3"/>
    </inertial>
  </link>

  <!-- Shoulder Pan Joint (Rotation around Z) -->
  <joint name="shoulder_pan_joint" type="revolute">
    <parent link="base_link"/>
    <child link="shoulder_link"/>
    <origin xyz="0.0 0.3 0.5" rpy="0 0 0"/>  <!-- Right shoulder -->
    <axis xyz="0 0 1"/>  <!-- Z-axis rotation -->
    <limit lower="-3.14159" upper="3.14159" effort="50.0" velocity="2.0"/>
    <dynamics damping="0.7" friction="0.0"/>
  </joint>

  <!-- Shoulder Link (Upper Arm Segment 1) -->
  <link name="shoulder_link">
    <visual>
      <geometry>
        <cylinder radius="0.05" length="0.1"/>  <!-- 5cm radius, 10cm long -->
      </geometry>
      <material name="blue">
        <color rgba="0.0 0.0 1.0 1.0"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <cylinder radius="0.05" length="0.1"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="1.0"/>
      <inertia ixx="0.01" ixy="0.0" ixz="0.0"
               iyy="0.01" iyz="0.0"
               izz="0.005"/>
    </inertial>
  </link>

  <!-- Shoulder Lift Joint (Rotation around Y) -->
  <joint name="shoulder_lift_joint" type="revolute">
    <parent link="shoulder_link"/>
    <child link="upper_arm_link"/>
    <origin xyz="0.0 0.0 0.05" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>  <!-- Y-axis rotation -->
    <limit lower="-1.57079" upper="1.57079" effort="50.0" velocity="2.0"/>
    <dynamics damping="0.7"/>
  </joint>

  <!-- Upper Arm Link -->
  <link name="upper_arm_link">
    <visual>
      <geometry>
        <box size="0.08 0.08 0.3"/>  <!-- 30cm upper arm -->
      </geometry>
      <origin xyz="0 0 0.15" rpy="0 0 0"/>  <!-- Center geometry -->
      <material name="blue">
        <color rgba="0.0 0.0 1.0 1.0"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <box size="0.08 0.08 0.3"/>
      </geometry>
      <origin xyz="0 0 0.15" rpy="0 0 0"/>
    </collision>
    <inertial>
      <mass value="2.0"/>
      <origin xyz="0 0 0.15" rpy="0 0 0"/>
      <inertia ixx="0.02" ixy="0.0" ixz="0.0"
               iyy="0.02" iyz="0.0"
               izz="0.005"/>
    </inertial>
  </link>

  <!-- Elbow Joint -->
  <joint name="elbow_flex_joint" type="revolute">
    <parent link="upper_arm_link"/>
    <child link="forearm_link"/>
    <origin xyz="0.0 0.0 0.3" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="0.0" upper="2.61799" effort="30.0" velocity="2.0"/>  <!-- 0-150° -->
    <dynamics damping="0.5"/>
  </joint>

  <!-- Forearm Link -->
  <link name="forearm_link">
    <visual>
      <geometry>
        <box size="0.06 0.06 0.25"/>  <!-- 25cm forearm -->
      </geometry>
      <origin xyz="0 0 0.125" rpy="0 0 0"/>
      <material name="blue">
        <color rgba="0.0 0.0 1.0 1.0"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <box size="0.06 0.06 0.25"/>
      </geometry>
      <origin xyz="0 0 0.125" rpy="0 0 0"/>
    </collision>
    <inertial>
      <mass value="1.5"/>
      <origin xyz="0 0 0.125" rpy="0 0 0"/>
      <inertia ixx="0.015" ixy="0.0" ixz="0.0"
               iyy="0.015" iyz="0.0"
               izz="0.003"/>
    </inertial>
  </link>

  <!-- Wrist Joint -->
  <joint name="wrist_flex_joint" type="revolute">
    <parent link="forearm_link"/>
    <child link="wrist_link"/>
    <origin xyz="0.0 0.0 0.25" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="-1.57079" upper="1.57079" effort="20.0" velocity="2.0"/>
    <dynamics damping="0.3"/>
  </joint>

  <!-- Wrist Link -->
  <link name="wrist_link">
    <visual>
      <geometry>
        <cylinder radius="0.03" length="0.08"/>
      </geometry>
      <material name="gray">
        <color rgba="0.5 0.5 0.5 1.0"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <cylinder radius="0.03" length="0.08"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.5"/>
      <inertia ixx="0.001" ixy="0.0" ixz="0.0"
               iyy="0.001" iyz="0.0"
               izz="0.0005"/>
    </inertial>
  </link>

  <!-- Gripper Joint (Simplified as fixed for now) -->
  <joint name="gripper_joint" type="fixed">
    <parent link="wrist_link"/>
    <child link="gripper_link"/>
    <origin xyz="0.0 0.0 0.08" rpy="0 0 0"/>
  </joint>

  <!-- Gripper Link -->
  <link name="gripper_link">
    <visual>
      <geometry>
        <box size="0.08 0.04 0.06"/>  <!-- Simplified gripper -->
      </geometry>
      <material name="red">
        <color rgba="1.0 0.0 0.0 1.0"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <box size="0.08 0.04 0.06"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.3"/>
      <inertia ixx="0.0005" ixy="0.0" ixz="0.0"
               iyy="0.0005" iyz="0.0"
               izz="0.0003"/>
    </inertial>
  </link>

</robot>
```

### Step 2: Validate URDF

**Install URDF Tools**:
```bash
sudo apt install ros-humble-urdf-tutorial -y
sudo apt install liburdfdom-tools -y
```

**Check URDF Syntax**:
```bash
check_urdf ~/ros2_ws/src/humanoid_description/urdf/humanoid_arm.urdf
```

**Expected Output**:
```
robot name is: humanoid_arm
---------- Successfully Parsed XML ---------------
root Link: base_link has 1 child(ren)
    child(1):  shoulder_link
        child(1):  upper_arm_link
            child(1):  forearm_link
                child(1):  wrist_link
                    child(1):  gripper_link
```

**Visualize URDF Tree**:
```bash
urdf_to_graphiz ~/ros2_ws/src/humanoid_description/urdf/humanoid_arm.urdf
# Generates humanoid_arm.pdf with link/joint tree
evince humanoid_arm.pdf &
```

### Step 3: Launch with RViz2

**Create Launch File**: `~/ros2_ws/src/humanoid_description/launch/display_urdf.launch.py`

```python
import os
from ament_index_python.packages import get_package_share_directory
from launch import LaunchDescription
from launch_ros.actions import Node
from launch.substitutions import Command

def generate_launch_description():
    # Get URDF file path
    urdf_file = os.path.join(
        get_package_share_directory('humanoid_description'),
        'urdf',
        'humanoid_arm.urdf'
    )

    # Read URDF file
    with open(urdf_file, 'r') as f:
        robot_description = f.read()

    # RViz configuration file
    rviz_config = os.path.join(
        get_package_share_directory('humanoid_description'),
        'rviz',
        'urdf_viewer.rviz'
    )

    return LaunchDescription([
        # Robot State Publisher (publishes TF from URDF + joint_states)
        Node(
            package='robot_state_publisher',
            executable='robot_state_publisher',
            name='robot_state_publisher',
            output='screen',
            parameters=[{'robot_description': robot_description}]
        ),

        # Joint State Publisher GUI (manual joint control)
        Node(
            package='joint_state_publisher_gui',
            executable='joint_state_publisher_gui',
            name='joint_state_publisher_gui',
            output='screen'
        ),

        # RViz2 (visualization)
        Node(
            package='rviz2',
            executable='rviz2',
            name='rviz2',
            output='screen',
            arguments=['-d', rviz_config]
        )
    ])
```

**RViz Configuration**: `~/ros2_ws/src/humanoid_description/rviz/urdf_viewer.rviz`

```yaml
Panels:
  - Class: rviz_common/Displays
    Name: Displays
  - Class: rviz_common/Views
    Name: Views

Visualization Manager:
  Displays:
    - Class: rviz_default_plugins/RobotModel
      Name: RobotModel
      Description Topic:
        Value: /robot_description
      Visual Enabled: true
      Collision Enabled: false

    - Class: rviz_default_plugins/TF
      Name: TF
      Show Axes: true
      Show Names: true
      Frame Timeout: 15.0

  Global Options:
    Fixed Frame: base_link
    Frame Rate: 30

  Views:
    Current:
      Class: rviz_default_plugins/Orbit
      Distance: 2.0
      Focal Point:
        X: 0.0
        Y: 0.0
        Z: 0.5
      Pitch: 0.5
      Yaw: 0.8
```

**Launch URDF Viewer**:
```bash
cd ~/ros2_ws
colcon build --packages-select humanoid_description
source install/setup.bash

ros2 launch humanoid_description display_urdf.launch.py
```

**Expected Visualization**:
- Gray box (base_link) at origin
- Blue arm segments extending from shoulder
- Red gripper at end-effector
- Joint State Publisher GUI with sliders for each joint
- Move sliders → Robot animates in RViz2

### Step 4: Joint Types and Axis Definitions

| Joint Type | DOF | Motion | Use Case |
|------------|-----|--------|----------|
| **revolute** | 1 | Rotation (limited range) | Elbow, shoulder, wrist |
| **continuous** | 1 | Rotation (unlimited) | Wheel axles |
| **prismatic** | 1 | Linear translation | Gripper fingers, telescoping arm |
| **fixed** | 0 | No motion | Sensor mounts, fixed links |
| **planar** | 2 | XY translation | Omni-directional base |
| **floating** | 6 | Full 6-DOF | Free-flying base (mobile robots) |

**Axis Examples**:
```xml
<!-- Shoulder pan: rotate around Z (yaw) -->
<axis xyz="0 0 1"/>

<!-- Elbow: rotate around Y (pitch) -->
<axis xyz="0 1 0"/>

<!-- Gripper: translate along X (open/close) -->
<axis xyz="1 0 0"/>
```

### Step 5: Visual vs. Collision Geometry

**Visual Geometry** (high-poly meshes for rendering):
```xml
<visual>
  <geometry>
    <mesh filename="package://humanoid_description/meshes/upper_arm.stl" scale="1.0 1.0 1.0"/>
  </geometry>
  <material name="robot_blue">
    <color rgba="0.2 0.4 0.8 1.0"/>
  </material>
</visual>
```

**Collision Geometry** (low-poly primitives for fast collision detection):
```xml
<collision>
  <geometry>
    <cylinder radius="0.05" length="0.3"/>  <!-- Simplified as cylinder -->
  </geometry>
</collision>
```

**Why Separate?**
- Visual: High detail for realism (10K+ triangles)
- Collision: Low detail for speed (10-100 triangles)
- Collision checks run at 100+ Hz, visual rendering at 30 Hz

### Step 6: Inertial Properties

**Correct Inertial Calculation** (for dynamics simulation):
```xml
<inertial>
  <mass value="2.5"/>  <!-- kg -->
  <origin xyz="0 0 0.15" rpy="0 0 0"/>  <!-- Center of mass offset -->
  <inertia ixx="0.02" ixy="0.0" ixz="0.0"
           iyy="0.02" iyz="0.0"
           izz="0.005"/>
</inertial>
```

**Inertia Tensor** (for box of size Lx × Ly × Lz, mass m):
```
ixx = (m/12) × (Ly² + Lz²)
iyy = (m/12) × (Lx² + Lz²)
izz = (m/12) × (Lx² + Ly²)
```

**Example**: 30cm × 8cm × 8cm upper arm, mass 2 kg:
```
ixx = (2/12) × (0.08² + 0.08²) = 0.00213
iyy = (2/12) × (0.30² + 0.08²) = 0.01607
izz = (2/12) × (0.30² + 0.08²) = 0.01607
```

## Robot State Publisher and TF

**robot_state_publisher** reads URDF + `/joint_states` topic → broadcasts TF transforms.

**Data Flow**:
```
URDF (static link geometry) + /joint_states (dynamic joint angles)
  ↓
robot_state_publisher
  ↓
/tf (dynamic transforms for moving joints)
/tf_static (static transforms for fixed links)
```

**Example**: Moving elbow joint from 0° → 90°:
1. Joint controller publishes `/joint_states`: `elbow_flex_joint: 1.57 rad`
2. robot_state_publisher reads URDF link lengths + joint angle
3. Computes forearm_link → base_link transform
4. Publishes to `/tf`
5. RViz2 subscribes to `/tf` → updates visualization

### Step 7: Package Structure

```
humanoid_description/
├── urdf/
│   ├── humanoid_arm.urdf          # Robot description
│   └── humanoid_full.urdf         # Full body (to be created)
├── meshes/
│   ├── upper_arm.stl              # Visual mesh
│   ├── forearm.stl
│   └── gripper.stl
├── rviz/
│   └── urdf_viewer.rviz           # RViz configuration
├── launch/
│   └── display_urdf.launch.py    # Visualization launcher
├── CMakeLists.txt
└── package.xml
```

**CMakeLists.txt**:
```cmake
cmake_minimum_required(VERSION 3.8)
project(humanoid_description)

# Install URDF files
install(DIRECTORY
  urdf
  meshes
  rviz
  DESTINATION share/${PROJECT_NAME}/
)

# Install launch files
install(DIRECTORY
  launch
  DESTINATION share/${PROJECT_NAME}/
)

ament_package()
```

**Build Package**:
```bash
cd ~/ros2_ws
colcon build --packages-select humanoid_description
source install/setup.bash
```

## URDF Best Practices

### 1. Consistent Naming

```xml
<!-- Good: Descriptive, hierarchical names -->
<link name="right_shoulder_link"/>
<joint name="right_shoulder_pan_joint" type="revolute"/>

<!-- Bad: Ambiguous -->
<link name="link3"/>
<joint name="j4"/>
```

### 2. Always Define Collision Geometry

```xml
<!-- Good: Both visual and collision -->
<link name="upper_arm_link">
  <visual>...</visual>
  <collision>...</collision>
  <inertial>...</inertial>
</link>

<!-- Bad: No collision (breaks MoveIt2) -->
<link name="upper_arm_link">
  <visual>...</visual>
</link>
```

### 3. Validate Joint Limits

```xml
<!-- Good: Realistic joint limits -->
<limit lower="-1.57" upper="1.57" effort="50.0" velocity="2.0"/>

<!-- Bad: No limits (infinite rotation) -->
<limit lower="-999" upper="999" effort="9999" velocity="999"/>
```

### 4. Use Materials Consistently

```xml
<!-- Define materials once -->
<material name="robot_blue">
  <color rgba="0.2 0.4 0.8 1.0"/>
</material>

<!-- Reference in links -->
<visual>
  <material name="robot_blue"/>
</visual>
```

## Next Steps

With URDF basics mastered, proceed to:
- **M1-C3-S2**: Xacro and Parametric URDF (macros for arms, modularity)
- **M1-C3-S3**: Forward Kinematics (compute end-effector pose from joint angles)
- **M1-C3-S4**: Inverse Kinematics (compute joint angles from target pose)

**Troubleshooting**:
- **URDF parse error**: Run `check_urdf` to find XML syntax errors
- **RViz2 shows nothing**: Check Fixed Frame is set to `base_link`
- **Joints don't move**: Ensure `/joint_states` topic is publishing
- **Collision geometry missing**: Add `<collision>` tags to all links

**Real-World URDF Examples**:
- Universal Robots UR5: `ur_description` package
- Franka Emika Panda: `franka_description` package
- Boston Dynamics Spot: `spot_description` package

---

**Assessment Preparation**: This section is **CRITICAL** for **Assessment 2: URDF and Kinematics (Week 6)**. You must demonstrate creating URDF files, visualizing in RViz2, and understanding link/joint relationships.
